<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyDial AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .step-card {
            transition: all 0.3s ease-in-out;
            opacity: 1;
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .step-card.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25em 0.6em;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 9999px;
        }
        .status-badge.green { background-color: #d1fae5; color: #065f46; }
        .status-badge.yellow { background-color: #fef3c7; color: #92400e; }
        .status-badge.blue { background-color: #dbeafe; color: #1e40af; }
        .status-badge.red { background-color: #fee2e2; color: #991b1b; }
        #resultsTable tbody tr, #callLogsTable tbody tr, #manualContactsTable tbody tr {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .progress-bar {
            transition: width 1s ease-out;
        }

        /* Live Sheets Tab Styles */
        .call-type-tabs {
            display: flex;
            background: #f1f5f9;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 1rem;
        }
        .call-type-tab {
            flex: 1;
            padding: 8px 16px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            color: #64748b;
        }
        .call-type-tab.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .call-type-tab:hover:not(.active) {
            background: #e2e8f0;
            color: #475569;
        }
        .sheet-iframe {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            width: 100%;
            height: 500px;
        }
        .live-indicator {
            display: inline-flex;
            align-items: center;
            color: #059669;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }
        .live-dot {
            width: 8px;
            height: 8px;
            background-color: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .sheet-container {
            display: none;
        }
        .sheet-container.active {
            display: block;
        }

        /* Additional styles for modal and transcript */
        .transcript-modal {
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 600px;
            position: relative;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
        }
        .close-btn {
            color: #aaa;
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .transcript-content {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .call-details {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }
        .table-container {
            overflow-x: auto;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
        }
        .data-table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
        }
        .data-table th, .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.875rem;
        }
        .data-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #475569;
        }
        .data-table tbody tr:last-child td {
            border-bottom: none;
        }
        .appointment-badge.success { background-color: #d1fae5; color: #065f46; }
        .appointment-badge.declined { background-color: #fee2e2; color: #991b1b; }
        .appointment-badge.pending { background-color: #fef3c7; color: #92400e; }
        .appointment-badge.unknown { background-color: #e5e7eb; color: #4b5563; }
        .view-btn {
            background-color: #eff6ff;
            color: #2563eb;
            font-weight: 500;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            border: 1px solid #dbeafe;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .view-btn:hover { background-color: #dbeafe; }
    </style>
</head>
<body class="text-slate-800" style="background-color: #F0F0F0;">
    
    <!-- Auth Page -->
    <div id="authContainer" class="fixed inset-0 z-[100] flex items-start justify-center p-4 sm:py-12 overflow-y-auto transition-opacity duration-300 ease-in-out" style="background-color: #F0F0F0;">
        <div class="w-full max-w-md bg-white p-6 sm:p-8 rounded-2xl shadow-md border border-slate-200">
            <h2 class="text-3xl font-bold text-center text-slate-900 mb-2">Welcome to EasyDial AI</h2>
            <p class="text-center text-slate-500 mb-6">Your intelligent calling solution.</p>
            
            <form id="authForm" class="space-y-4">
                <div id="companyNameField" class="hidden">
                    <label for="companyName" class="block text-sm font-medium text-slate-700">Company Name</label>
                    <input type="text" name="companyName" id="companyName" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                </div>
                <div id="industryField" class="hidden">
                    <label for="industry" class="block text-sm font-medium text-slate-700">Industry</label>
                    <input type="text" name="industry" id="industry" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                </div>
                <div id="companySizeField" class="hidden">
                    <label for="companySize" class="block text-sm font-medium text-slate-700">Company Size</label>
                     <select id="companySize" name="companySize" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm rounded-md transition-colors duration-150">
                         <option>1-10 employees</option>
                         <option>11-50 employees</option>
                         <option>51-200 employees</option>
                         <option>201-500 employees</option>
                         <option>500+ employees</option>
                    </select>
                </div>
                 <div>
                    <label for="email" class="block text-sm font-medium text-slate-700">Email Address</label>
                    <input type="email" name="email" id="email" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-slate-700">Password</label>
                    <input type="password" name="password" id="password" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                </div>
                <div>
                    <button type="submit" id="authSubmitBtn" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 mt-6 transition-colors duration-200">
                        Log in
                    </button>
                </div>
            </form>

            <div id="loginToggleText" class="mt-6 text-center text-sm text-slate-500">
                Don't have an account?
                <button type="button" id="switchToSignupBtn" class="font-medium text-blue-600 hover:text-blue-500 focus:outline-none">Sign up</button>
            </div>

            <div id="signupToggleText" class="hidden mt-6 text-center text-sm text-slate-500">
                Already have an account?
                <button type="button" id="switchToLoginBtn" class="font-medium text-blue-600 hover:text-blue-500 focus:outline-none">Log in</button>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer">
        <!-- New Top Navigation Bar -->
        <div class="fixed top-0 left-0 w-full z-50 p-8">
            <nav class="bg-white text-slate-800 shadow-lg rounded-3xl">
                <div class="container mx-auto px-6 py-3 flex justify-between items-center">
                    <h1 id="sidebarCompanyName" class="text-xl font-bold">EasyDial AI</h1>
                    <div class="relative">
                        <button id="menuButton" class="flex items-center justify-center h-10 w-10 rounded-full bg-slate-100 hover:bg-slate-200 focus:outline-none transition-colors duration-200">
                            <svg class="h-6 w-6 text-slate-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                        <div id="dropdownMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                            <a href="#" id="navDashboard" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 transition-colors duration-150">Dashboard</a>
                            <a href="#" id="navCallLogs" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100 transition-colors duration-150">Call Logs</a>
                        </div>
                    </div>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="pt-32"> 
            <div id="dashboardView" class="container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
                <!-- Header -->
                <header class="text-center mb-8">
                    <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-slate-900">Dashboard</h1>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Box 1: Clone Voice -->
                    <section id="step1" class="step-card bg-white p-8 sm:p-10 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-between">
                        <div>
                            <div class="flex items-center mb-3">
                                <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-10 w-10 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg></div>
                                <div class="ml-3">
                                    <h2 class="text-lg font-semibold text-slate-900">Clone Your Voice</h2>
                                </div>
                            </div>
                             <p class="text-xs text-slate-500 mb-4">Create a natural, AI-generated voice for your campaigns.</p>
                            <div class="mt-4 bg-slate-50 p-3 rounded-lg">
                                <div id="cloneInitialState" class="flex flex-col items-center justify-between">
                                    <div id="voiceStatus" class="flex items-center mb-3 text-sm"><svg id="voiceStatusIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" /></svg><span id="voiceStatusText" class="font-medium">Status: Not Cloned</span></div>
                                    <button id="initiateCloneBtn" class="w-full text-sm flex items-center justify-center bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"><span>Clone Voice</span></button>
                                </div>
                                <div id="cloneUploadState" class="hidden space-y-3">
                                    <p class="text-xs text-slate-600">Upload a clear audio recording (.wav, .mp3) of your voice.</p>
                                    <div class="flex flex-col items-center justify-between">
                                        <div class="w-full mb-3">
                                            <label for="audio-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500 border border-slate-300 px-3 py-1.5 text-sm flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg><span id="audioFileName">Upload audio file</span><input id="audio-upload" name="audio-upload" type="file" class="sr-only" accept="audio/*"></label>
                                        </div>
                                        <button id="startCloningBtn" class="w-full text-sm flex items-center justify-center bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed duration-200" disabled><span id="startCloningBtnText">Start Cloning</span><div id="startCloningBtnLoader" class="loader hidden ml-2"></div></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Box 2: Create Campaign -->
                    <section id="step2" class="step-card bg-white p-8 sm:p-10 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-between">
                        <div>
                            <div class="flex items-center mb-3"><div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-10 w-10 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg></div><div class="ml-3"><h2 class="text-lg font-semibold text-slate-900">Create Campaign</h2></div></div>
                             <p class="text-xs text-slate-500 mb-4">Start your calling campaign by uploading a file or adding contacts manually.</p>
                            <div class="mt-4 flex flex-col items-center justify-between bg-slate-50 p-3 rounded-lg">
                                <div class="w-full mb-2">
                                    <label for="file-upload" class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500 border border-slate-300 px-3 py-1.5 text-sm flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg><span id="fileName">Upload .xlsx file</span><input id="file-upload" name="file-upload" type="file" class="sr-only" accept=".xlsx, .xls, .csv"></label>
                                </div>
                                <div class="text-slate-500 my-1 text-xs">or</div>
                                <button id="manualEntryBtn" class="w-full text-sm bg-white text-blue-600 font-semibold py-2 px-4 rounded-lg border border-slate-300 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">Add Manually</button>
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <button id="createCampaignBtn" class="w-full text-sm bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors disabled:bg-slate-300 disabled:cursor-not-allowed duration-200" disabled>Create Campaign</button>
                            <p id="campaignReadyText" class="text-xs text-slate-500 mt-1 h-4"></p>
                        </div>
                    </section>

                    <!-- Box 3: Call Activity -->
                    <section class="step-card bg-white p-8 sm:p-10 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-between">
                        <div>
                            <div class="flex items-center mb-3">
                                <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-10 w-10 flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h2 class="text-lg font-semibold text-slate-900">Call Activity</h2>
                                </div>
                            </div>
                            <p class="text-xs text-slate-500 mb-4">See your campaign performance at a glance.</p>
                            <div class="mt-4 space-y-4">
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium text-green-700">Confirmed Calls</span>
                                        <span id="confirmedCallsPercent" class="text-xs font-medium text-green-700">0%</span>
                                    </div>
                                    <div class="w-full bg-slate-200 rounded-full h-2">
                                        <div id="confirmedCallsBar" class="progress-bar bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-1">
                                        <span class="text-sm font-medium text-yellow-700">Canceled Calls</span>
                                        <span id="rescheduledCallsPercent" class="text-xs font-medium text-yellow-700">0%</span>
                                    </div>
                                    <div class="w-full bg-slate-200 rounded-full h-2">
                                        <div id="rescheduledCallsBar" class="progress-bar bg-yellow-400 h-2 rounded-full" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Box 4: Report Section -->
                     <section class="step-card bg-white p-8 sm:p-10 rounded-xl shadow-sm border border-slate-200 flex flex-col justify-between">
                        <div>
                            <div class="flex items-center mb-3">
                                <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-10 w-10 flex items-center justify-center">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                                <div class="ml-3">
                                    <h2 class="text-lg font-semibold text-slate-900">Report Section</h2>
                                </div>
                            </div>
                            <p class="text-xs text-slate-500 mb-4">Dive deep into call analytics and live data feeds.</p>
                        </div>
                         <div class="mt-4 text-center">
                            <button id="viewReportsBtn" class="w-full text-sm bg-white text-blue-600 font-semibold py-2 px-4 rounded-lg border border-slate-300 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">View Reports</button>
                        </div>
                    </section>
                </div>

                <section id="campaignStatus" class="hidden bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200 mb-8">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-12 w-12 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-xl font-semibold text-slate-900">Campaign Active</h2>
                                <p id="campaignStatusText" class="text-slate-500">Calls in progress...</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                             <div class="loader"></div>
                             <span class="text-sm text-slate-600">Processing...</span>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Call Logs View -->
            <div id="callLogsView" class="hidden container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12">
                <section class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200">
                    <div class="flex items-center mb-6">
                        <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-12 w-12 flex items-center justify-center">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>
                        </div>
                        <div class="ml-4">
                            <h2 class="text-2xl font-semibold text-slate-900">Live Call Logs</h2>
                            <p class="text-slate-500">Real-time call attempts and logs by call type.</p>
                        </div>
                    </div>
                    
                    <!-- Live indicator -->
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Live data - Auto-refreshing every 30 seconds</span>
                    </div>

                    <!-- Call Type Tabs for Call Logs -->
                    <div class="call-type-tabs">
                        <div class="call-type-tab active" onclick="showCallLogsType('reminder')">üìû Reminder</div>
                        <div class="call-type-tab" onclick="showCallLogsType('medical')">üè• Medical</div>
                        <div class="call-type-tab" onclick="showCallLogsType('realestate')">üè† Real Estate</div>
                        <div class="call-type-tab" onclick="showCallLogsType('sales')">üíº Sales</div>
                    </div>

                    <!-- Sheet Containers for Call Logs (Call Attempts) -->
                    <div id="logs-reminder-container" class="sheet-container active">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT_ad1-ty6K2w_NbBZWI-_EGtyAId6G_Ywbmw5vKUzzP8rGD_Z3SUAg8TWIJZeHfwI_5fAJad16s03H/pubhtml?gid=0&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>

                    <div id="logs-medical-container" class="sheet-container">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT_ad1-ty6K2w_NbBZWI-_EGtyAId6G_Ywbmw5vKUzzP8rGD_Z3SUAg8TWIJZeHfwI_5fAJad16s03H/pubhtml?gid=59146364&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>

                    <div id="logs-realestate-container" class="sheet-container">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT_ad1-ty6K2w_NbBZWI-_EGtyAId6G_Ywbmw5vKUzzP8rGD_Z3SUAg8TWIJZeHfwI_5fAJad16s03H/pubhtml?gid=200949817&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>

                    <div id="logs-sales-container" class="sheet-container">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT_ad1-ty6K2w_NbBZWI-_EGtyAId6G_Ywbmw5vKUzzP8rGD_Z3SUAg8TWIJZeHfwI_5fAJad16s03H/pubhtml?gid=109435437&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>
                </section>
            </div>

            <!-- Manual Entry View -->
            <div id="manualEntryView" class="hidden container mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 py-12">
                 <section class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-12 w-12 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-2xl font-semibold text-slate-900">Add Contacts Manually</h2>
                                <p class="text-slate-500">Enter contact and appointment details below.</p>
                            </div>
                        </div>
                         <button id="returnToDashboardBtn" class="bg-slate-100 text-slate-700 font-semibold py-2 px-5 rounded-lg hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-400 transition-colors">Return to Dashboard</button>
                    </div>

                    <form id="manualContactForm" class="p-4 bg-slate-50 rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label for="contactName" class="block text-sm font-medium text-slate-700">Name</label>
                            <input type="text" name="contactName" id="contactName" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                        </div>
                        <div>
                            <label for="contactCompanyName" class="block text-sm font-medium text-slate-700">Company Name</label>
                            <input type="text" name="contactCompanyName" id="contactCompanyName" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                        </div>
                        <div>
                            <label for="contactPhone" class="block text-sm font-medium text-slate-700">Phone Number</label>
                            <input type="tel" name="contactPhone" id="contactPhone" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                        </div>
                        <div>
                            <label for="contactDate" class="block text-sm font-medium text-slate-700">Appointment Date</label>
                            <input type="date" name="contactDate" id="contactDate" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                        </div>
                        <div>
                            <label for="contactTime" class="block text-sm font-medium text-slate-700">Appointment Time</label>
                            <input type="time" name="contactTime" id="contactTime" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                        </div>
                        <div>
                            <label for="callType" class="block text-sm font-medium text-slate-700">Call Type</label>
                            <select id="callType" name="callType" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                                <option value="" disabled selected>Select a call type</option>
                                <option value="Medical">Medical</option>
                                <option value="Real_Estate">Real Estate</option>
                                <option value="Sales">Sales</option>
                                <option value="Reminder">Reminder</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="contactReason" class="block text-sm font-medium text-slate-700">Reason for Appointment</label>
                            <input type="text" name="contactReason" id="contactReason" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-300 focus:border-blue-500 sm:text-sm transition-colors duration-150">
                        </div>
                        <div class="md:col-span-2 text-right">
                             <button type="submit" class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">Add Contact</button>
                        </div>
                    </form>
                    
                    <h3 class="text-lg font-semibold text-slate-800 mb-2">Added Contacts</h3>
                    <div class="overflow-x-auto border rounded-lg">
                        <table class="min-w-full divide-y divide-slate-200">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Company</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Phone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Appointment</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Call Type</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider"></th>
                                </tr>
                            </thead>
                            <tbody id="manualContactsTableBody" class="bg-white divide-y divide-slate-200">
                                <tr id="noManualContactsRow"><td colspan="6" class="text-center text-slate-500 py-6">No contacts added yet.</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
            
            <!-- Reports View -->
            <div id="reportsView" class="hidden container mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-12">
                <section class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg border border-slate-200">
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 bg-blue-100 text-blue-600 rounded-full h-12 w-12 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                            <div class="ml-4">
                                <h2 class="text-2xl font-semibold text-slate-900">Live Call Results</h2>
                                <p class="text-slate-500">Real-time call outcomes by call type.</p>
                            </div>
                        </div>
                         <button id="returnToDashboardFromReportsBtn" class="bg-slate-100 text-slate-700 font-semibold py-2 px-5 rounded-lg hover:bg-slate-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-400 transition-colors">Return to Dashboard</button>
                    </div>
                    
                    <!-- Live indicator -->
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        <span>Live data - Auto-refreshing every 30 seconds</span>
                    </div>

                    <!-- Call Type Tabs for Call Results -->
                    <div class="call-type-tabs">
                        <div class="call-type-tab active" onclick="showCallResultsType('reminder')">üìû Reminder</div>
                        <div class="call-type-tab" onclick="showCallResultsType('medical')">üè• Medical</div>
                        <div class="call-type-tab" onclick="showCallResultsType('realestate')">üè† Real Estate</div>
                        <div class="call-type-tab" onclick="showCallResultsType('sales')">üíº Sales</div>
                    </div>

                    <!-- Sheet Containers for Call Results -->
                    <div id="results-reminder-container" class="sheet-container active">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT5JGR2BozZ34asP-72GQA1Rh4ekjV3TvhOV5yO8ewvO-be52zYupZptyN-sO1UvkLuYwJi46BSaMpI/pubhtml?gid=0&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>

                    <div id="results-medical-container" class="sheet-container">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT5JGR2BozZ34asP-72GQA1Rh4ekjV3TvhOV5yO8ewvO-be52zYupZptyN-sO1UvkLuYwJi46BSaMpI/pubhtml?gid=626821407&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>

                    <div id="results-realestate-container" class="sheet-container">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT5JGR2BozZ34asP-72GQA1Rh4ekjV3TvhOV5yO8ewvO-be52zYupZptyN-sO1UvkLuYwJi46BSaMpI/pubhtml?gid=921830522&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>

                    <div id="results-sales-container" class="sheet-container">
                        <iframe 
                            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vT5JGR2BozZ34asP-72GQA1Rh4ekjV3TvhOV5yO8ewvO-be52zYupZptyN-sO1UvkLuYwJi46BSaMpI/pubhtml?gid=1455727579&single=true&widget=true&headers=false" 
                            class="sheet-iframe">
                        </iframe>
                    </div>
                </section>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- CONFIG ---
    const N8N_MANUAL_CONTACT_URL = "https://easydialai.app.n8n.cloud/webhook/manual-contact";

    // --- ELEMENTS ---
    const authContainer = document.getElementById('authContainer');
    const appContainer = document.getElementById('appContainer');
    const authForm = document.getElementById('authForm');
    const companyNameInput = document.getElementById('companyName');
    const companyNameField = document.getElementById('companyNameField');
    const industryField = document.getElementById('industryField');
    const companySizeField = document.getElementById('companySizeField');
    const authSubmitBtn = document.getElementById('authSubmitBtn');
    const switchToSignupBtn = document.getElementById('switchToSignupBtn');
    const switchToLoginBtn = document.getElementById('switchToLoginBtn');
    const loginToggleText = document.getElementById('loginToggleText');
    const signupToggleText = document.getElementById('signupToggleText');
    const sidebarCompanyName = document.getElementById('sidebarCompanyName');
    const navDashboard = document.getElementById('navDashboard');
    const navCallLogs = document.getElementById('navCallLogs');
    const dashboardView = document.getElementById('dashboardView');
    const callLogsView = document.getElementById('callLogsView');
    const manualEntryView = document.getElementById('manualEntryView');
    const reportsView = document.getElementById('reportsView');
    const createCampaignBtn = document.getElementById('createCampaignBtn');
    const fileUpload = document.getElementById('file-upload');
    const campaignReadyText = document.getElementById('campaignReadyText');
    const manualContactForm = document.getElementById('manualContactForm');
    const manualContactsTableBody = document.getElementById('manualContactsTableBody');
    const noManualContactsRow = document.getElementById('noManualContactsRow');
    const fileNameEl = document.getElementById('fileName');
    const campaignStatus = document.getElementById('campaignStatus');
    const campaignStatusText = document.getElementById('campaignStatusText');
    const menuButton = document.getElementById('menuButton');
    const dropdownMenu = document.getElementById('dropdownMenu');

    // Button elements
    const manualEntryBtn = document.getElementById('manualEntryBtn');
    const returnToDashboardBtn = document.getElementById('returnToDashboardBtn');
    const returnToDashboardFromReportsBtn = document.getElementById('returnToDashboardFromReportsBtn');
    const viewReportsBtn = document.getElementById('viewReportsBtn');
    const initiateCloneBtn = document.getElementById('initiateCloneBtn');
    const startCloningBtn = document.getElementById('startCloningBtn');

    // Voice Cloning elements
    const cloneInitialState = document.getElementById('cloneInitialState');
    const cloneUploadState = document.getElementById('cloneUploadState');
    const audioUpload = document.getElementById('audio-upload');
    const audioFileName = document.getElementById('audioFileName');

    // --- STATE ---
    let isFileUploaded = false;
    let manualContacts = [];
    let campaignActive = false;

    // --- AUTH LOGIC ---
    let isSignUp = false;
    switchToSignupBtn.addEventListener('click', () => {
        isSignUp = true;
        companyNameField.classList.remove('hidden');
        industryField.classList.remove('hidden');
        companySizeField.classList.remove('hidden');
        authSubmitBtn.textContent = 'Sign up';
        loginToggleText.classList.add('hidden');
        signupToggleText.classList.remove('hidden');
    });
    switchToLoginBtn.addEventListener('click', () => {
        isSignUp = false;
        companyNameField.classList.add('hidden');
        industryField.classList.add('hidden');
        companySizeField.classList.add('hidden');
        authSubmitBtn.textContent = 'Log in';
        loginToggleText.classList.remove('hidden');
        signupToggleText.classList.add('hidden');
    });
    authForm.addEventListener('submit', (e) => {
        e.preventDefault();
        if (isSignUp) {
            const companyName = companyNameInput.value;
            if (companyName) {
                sidebarCompanyName.textContent = companyName;
            }
        }
        authContainer.classList.add('opacity-0');
        setTimeout(() => {
            authContainer.classList.add('hidden');
            appContainer.classList.remove('hidden');
            
            // Start auto-refresh for iframes when app loads
            startAutoRefresh();
        }, 300);
    });

    // --- EVENT LISTENERS ---
    initiateCloneBtn.addEventListener('click', () => {
        cloneInitialState.classList.add('hidden');
        cloneUploadState.classList.remove('hidden');
    });
    fileUpload.addEventListener('change', handleFileUpload);
    createCampaignBtn.addEventListener('click', handleCampaignCreation);
    navDashboard.addEventListener('click', (e) => showView(e, dashboardView));
    navCallLogs.addEventListener('click', (e) => showView(e, callLogsView));
    manualEntryBtn.addEventListener('click', (e) => showView(e, manualEntryView));
    viewReportsBtn.addEventListener('click', (e) => showView(e, reportsView));
    returnToDashboardBtn.addEventListener('click', (e) => showView(e, dashboardView));
    returnToDashboardFromReportsBtn.addEventListener('click', (e) => showView(e, dashboardView));
    manualContactForm.addEventListener('submit', handleAddContact);
    
    // New Nav Menu Logic
    menuButton.addEventListener('click', () => {
        dropdownMenu.classList.toggle('hidden');
    });

    window.addEventListener('click', (e) => {
        if (!menuButton.contains(e.target) && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.add('hidden');
        }
    });
    
    // --- VIEW MANAGEMENT ---
    function showView(e, viewToShow) {
        if (e) e.preventDefault();
        [dashboardView, callLogsView, manualEntryView, reportsView].forEach(v => v.classList.add('hidden'));
        viewToShow.classList.remove('hidden');
        dropdownMenu.classList.add('hidden');
    }

    // --- CONTACT MANAGEMENT ---
    function handleFileUpload(event) {
        const file = event.target.files[0];
        isFileUploaded = !!file;
        fileNameEl.textContent = file ? file.name : 'Upload .xlsx file';
        checkCampaignReady();
    }

    function handleAddContact(e) {
        e.preventDefault();
        const contact = {
            name: e.target.contactName.value,
            companyName: e.target.contactCompanyName.value,
            phone: e.target.contactPhone.value,
            date: e.target.contactDate.value,
            time: e.target.contactTime.value,
            reason: e.target.contactReason.value,
            callType: e.target.callType.value
        };

        manualContacts.push(contact);
        renderManualContacts();
        checkCampaignReady();
        manualContactForm.reset();
    }

    function renderManualContacts() {
        manualContactsTableBody.innerHTML = '';
        if (manualContacts.length === 0) {
            manualContactsTableBody.appendChild(noManualContactsRow);
        } else {
            manualContacts.forEach((contact, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `<td class="px-6 py-4 text-sm font-medium text-slate-900">${contact.name}</td>
                    <td class="px-6 py-4 text-sm text-slate-500">${contact.companyName || 'N/A'}</td>
                    <td class="px-6 py-4 text-sm text-slate-500">${contact.phone}</td>
                    <td class="px-6 py-4 text-sm text-slate-500">${contact.date} at ${contact.time}</td>
                    <td class="px-6 py-4 text-sm text-slate-500">${contact.callType}</td>
                    <td class="px-6 py-4 text-right text-sm font-medium"><button data-index="${index}" class="text-red-600 hover:text-red-900 remove-contact-btn">Remove</button></td>`;
                manualContactsTableBody.appendChild(row);
            });
        }
    }
    
    manualContactsTableBody.addEventListener('click', (e) => {
        if (e.target.classList.contains('remove-contact-btn')) {
            const index = e.target.dataset.index;
            manualContacts.splice(index, 1);
            renderManualContacts();
            checkCampaignReady();
        }
    });

    function checkCampaignReady() {
        const ready = isFileUploaded || manualContacts.length > 0;
        createCampaignBtn.disabled = !ready || campaignActive;
        campaignReadyText.textContent = ready ? (manualContacts.length > 0 ? `${manualContacts.length} contact(s) added.` : 'File uploaded.') : '';
    }

    // --- CAMPAIGN MANAGEMENT ---
    async function handleCampaignCreation() {
        campaignActive = true;
        createCampaignBtn.disabled = true;
        createCampaignBtn.innerHTML = `<div class="loader inline-block mr-2"></div><span>Starting Campaign...</span>`;
        campaignStatus.classList.remove('hidden');
        const contactsToCall = [...manualContacts];

        if (contactsToCall.length > 0) {
            campaignStatusText.textContent = `Sending ${contactsToCall.length} contacts to workflow...`;

            try {
                const sendContactPromises = contactsToCall.map(contact => {
                    const cleanContact = {
                        Name: (contact.name || '').toString().trim().replace(/[\r\n\t=]+/g, ''),
                        CompanyName: (contact.companyName || '').toString().trim().replace(/[\r\n\t=]+/g, ''),
                        Phone: (contact.phone || '').toString().trim().replace(/[\r\n\t=]+/g, ''),
                        Date: (contact.date || '').toString().trim().replace(/[\r\n\t=]+/g, ''),
                        Time: (contact.time || '').toString().trim().replace(/[\r\n\t=]+/g, ''),
                        Reason: (contact.reason || '').toString().trim().replace(/[\r\n\t=]+/g, ''),
                        CallType: (contact.callType || '').toString().trim().replace(/[\r\n\t=]+/g, '')
                    };
                    return fetch(N8N_MANUAL_CONTACT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(cleanContact)
                    });
                });

                const responses = await Promise.all(sendContactPromises);
                const allOk = responses.every(res => res.ok);

                if (allOk) {
                    console.log('All contacts sent to n8n successfully');
                    campaignStatusText.textContent = `Campaign for ${contactsToCall.length} contacts is now active.`;
                    
                    setTimeout(() => {
                        campaignActive = false;
                        createCampaignBtn.innerHTML = 'Create Campaign';
                        campaignStatus.classList.add('hidden');
                        checkCampaignReady();
                    }, 10000); 

                } else {
                    throw new Error('One or more contacts failed to send.');
                }

            } catch (error) {
                console.error('Error starting campaign:', error);
                campaignStatusText.textContent = `Error starting campaign. Please check the console.`;
                campaignActive = false;
                createCampaignBtn.disabled = false;
                createCampaignBtn.innerHTML = 'Create Campaign';
                return; 
            }

            manualContacts = [];
            renderManualContacts();
            checkCampaignReady();
            
        } else {
            campaignActive = false;
            createCampaignBtn.disabled = false;
            createCampaignBtn.innerHTML = 'Create Campaign';
            campaignStatus.classList.add('hidden');
        }
    }

    // --- LIVE SHEETS TAB SWITCHING ---
    window.showCallLogsType = function(callType) {
        document.querySelectorAll('#callLogsView .call-type-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('#callLogsView .sheet-container').forEach(container => container.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById(`logs-${callType}-container`).classList.add('active');
    }

    window.showCallResultsType = function(callType) {
        document.querySelectorAll('#reportsView .call-type-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('#reportsView .sheet-container').forEach(container => container.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById(`results-${callType}-container`).classList.add('active');
    }

    // --- AUTO-REFRESH IFRAMES ---
    function startAutoRefresh() {
        setInterval(() => {
            document.querySelectorAll('.sheet-iframe').forEach(iframe => {
                const currentSrc = iframe.src;
                iframe.src = '';
                setTimeout(() => { iframe.src = currentSrc; }, 100);
            });
            console.log('Live sheets refreshed at:', new Date().toLocaleTimeString());
        }, 30000);
    }

    // --- INITIALIZATION ---
    function setMinContactDate() {
        const contactDateInput = document.getElementById('contactDate');
        if (contactDateInput) {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            contactDateInput.min = `${yyyy}-${mm}-${dd}`;
        }
    }

    function init() {
        checkCampaignReady();
        setMinContactDate();
        startAutoRefresh();
    }
    
    init();
});
</script>
</body>
</html>
